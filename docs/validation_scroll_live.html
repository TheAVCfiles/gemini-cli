<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The Validation Scroll ‚Äî Live Annex</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root{--ink:#e6f0ff; --sky:#9efcff; --ocean:#004e92; --deep:#000428;}
    body{font-family:'Inter',sans-serif;background:radial-gradient(circle at top right,var(--ocean) 0%,var(--deep) 55%) fixed;color:var(--ink);}
    .glass-card{background:rgba(10,15,40,.5);backdrop-filter:blur(10px);border:1px solid rgba(0,78,146,.35);border-radius:12px;}
    .chart-container{position:relative;width:100%;max-width:700px;margin-inline:auto;height:320px;}
    @media(min-width:768px){.chart-container{height:360px;}}
    /* Glow pulse when regime flips */
    @keyframes glowOpen{0%{box-shadow:0 0 0 0 rgba(158,252,255,.0)} 30%{box-shadow:0 0 24px 6px rgba(158,252,255,.55)} 100%{box-shadow:0 0 0 0 rgba(158,252,255,.0)}}
    @keyframes glowClosed{0%{box-shadow:0 0 0 0 rgba(255,107,107,.0)} 30%{box-shadow:0 0 24px 6px rgba(255,107,107,.55)} 100%{box-shadow:0 0 0 0 rgba(255,107,107,.0)}}
    .pulse-open{animation:glowOpen .9s ease-in-out;}
    .pulse-closed{animation:glowClosed .9s ease-in-out;}
  </style>
</head>
<body class="antialiased">
  <div class="container mx-auto p-4 md:p-8">
    <header class="text-center my-10">
      <h1 class="text-4xl md:text-6xl font-black tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-white">
        The Validation Scroll <span class="text-base align-top">‚Äî Live</span>
      </h1>
      <p class="mt-4 text-lg md:text-xl text-blue-200 max-w-3xl mx-auto">
        The market-physics annex for the Gliss√© Engine. It reads a single JSON: <code>regime_snapshot.json</code>.
      </p>
    </header>

    <main class="space-y-14">
      <!-- Physics Cards -->
      <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="glass-card p-6 text-center">
          <div class="text-4xl mb-3">‚öõÔ∏è</div>
          <h3 class="text-xl font-bold mb-2 text-blue-300">Astro‚ÄëGann Cycles</h3>
          <p class="text-blue-100">Deterministic 360¬∞ timing; price‚Äìtime squaring around pivots; harmonics drive windows.</p>
        </div>
        <div class="glass-card p-6 text-center">
          <div class="text-4xl mb-3">üìä</div>
          <h3 class="text-xl font-bold mb-2 text-blue-300">Sector Rotation Law</h3>
          <p class="text-blue-100">Biasing by transiting configurations (Jupiter/Saturn), used only as context filters.</p>
        </div>
        <div class="glass-card p-6 text-center">
          <div class="text-4xl mb-3">üî¨</div>
          <h3 class="text-xl font-bold mb-2 text-blue-300">Integrity Gate</h3>
          <p class="text-blue-100">Structure ‚â• 80 ‚Üí œÑ* CI excludes 0 ‚Üí p < 0.05. No scaling in ambiguity. Typed exits.</p>
        </div>
      </section>

      <!-- Charts -->
      <section class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="glass-card p-6">
          <h3 class="text-2xl font-bold mb-3 text-blue-300">Gann Harmony: Square Hits</h3>
          <p class="text-blue-100 mb-4">Harmonic residue vs pivot; zero-crossings imply turn windows.</p>
          <div class="chart-container"><canvas id="gannChart"></canvas></div>
        </div>
        <div class="glass-card p-6">
          <h3 class="text-2xl font-bold mb-3 text-blue-300">TRI* ‚Äî Tap Response Index</h3>
          <p class="text-blue-100 mb-4">Multi-channel shock Z-scores normalized by structural weight.</p>
          <div class="chart-container"><canvas id="triChart"></canvas></div>
        </div>
      </section>

      <!-- Integrity Gate Flow -->
      <section id="gateCard" class="glass-card p-6">
        <h3 class="text-2xl font-bold mb-6 text-blue-300 text-center">Cunning Mercy ‚Äî Integrity Gate</h3>
        <div class="w-full overflow-x-auto p-2">
          <div class="rounded-lg flex flex-col md:flex-row items-center justify-around space-y-6 md:space-y-0 md:space-x-6 min-w-[700px]">
            <div class="text-center">
              <div class="p-4 bg-blue-900/50 border-2 border-blue-500 rounded-lg">Signal Input</div>
            </div>
            <div class="text-4xl text-blue-400 font-thin">‚Üí</div>
            <div class="text-center">
              <div class="p-4 border-2 border-blue-500 rounded-lg transform rotate-45">
                <p class="transform -rotate-45">Structural W ‚â• 80?</p>
              </div>
            </div>
            <div class="text-4xl text-blue-400 font-thin">‚Üí</div>
            <div class="text-center">
              <div class="p-4 border-2 border-blue-500 rounded-lg transform rotate-45">
                <p class="transform -rotate-45">œÑ* CI Excludes 0?</p>
              </div>
            </div>
            <div class="text-4xl text-blue-400 font-thin">‚Üí</div>
            <div class="text-center">
              <div class="p-4 border-2 border-blue-500 rounded-lg transform rotate-45">
                <p class="transform -rotate-45">p < 0.05?</p>
              </div>
            </div>
            <div class="text-4xl text-blue-400 font-thin">‚Üí</div>
            <div class="text-center">
              <div id="openBadge" class="p-4 bg-green-900/50 border-2 border-green-500 rounded-lg">Regime: OPEN</div>
              <div id="closedBadge" class="p-4 bg-red-900/50 border-2 border-red-500 rounded-lg mt-4">Regime: CLOSED</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Live Output -->
      <section class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div id="triCard" class="glass-card p-6 flex flex-col items-center justify-center">
          <h3 class="text-2xl font-bold mb-3 text-blue-300">Final TRI* Score</h3>
          <p class="text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-white">
            <span id="triSigmaVal">‚Äî</span>œÉ
          </p>
          <p class="text-blue-200 mt-2" id="triMeta">Waiting for snapshot‚Ä¶</p>
        </div>
        <div class="glass-card p-6">
          <h3 class="text-2xl font-bold mb-3 text-blue-300">Action Protocol</h3>
          <div class="space-y-4">
            <div>
              <p class="font-bold">Structural Weight (Wtap): <span class="text-blue-300"><span id="wtapVal">‚Äî</span>%</span></p>
              <p class="text-sm text-blue-200">Gate #1 ‚Äî structural conviction.</p>
            </div>
            <div>
              <p class="font-bold">Kinetic Gain Factor: <span class="text-blue-300"><span id="kgfVal">‚Äî</span>x</span></p>
              <p class="text-sm text-blue-200">Position scaler from impact physics.</p>
            </div>
            <div>
              <p class="font-bold">Trading Action:
                <span id="actionVal" class="text-blue-300">‚Äî</span>
              </p>
              <p class="text-sm text-blue-200">Policy: 1.0‚Äì1.2% equity risk only when OPEN.</p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="text-center mt-16 py-8 border-t border-blue-500/20">
      <p class="text-blue-300">Infographic generated from the Balanchine Cipher canon.</p>
      <p class="text-sm text-blue-400/50 mt-2">Illustrative only. Not financial advice.</p>
    </footer>
  </div>

  <script>
    // Shared chart options
    const chartDefaultOptions = {
      maintainAspectRatio:false,responsive:true,
      plugins:{legend:{labels:{color:'#cbd5e1'}},tooltip:{callbacks:{title:(items)=>{
        const label=items[0].chart.data.labels[items[0].dataIndex];
        return Array.isArray(label)?label.join(' '):label;}}}},
      scales:{x:{ticks:{color:'#94a3b8'},grid:{color:'rgba(71,85,105,.5)'}},
              y:{ticks:{color:'#94a3b8'},grid:{color:'rgba(71,85,105,.5)'}}}
    };

    // Gann chart
    new Chart(document.getElementById('gannChart'),{
      type:'line',
      data:{labels:['-90d','-60d','-30d','Pivot','+30d','+60d','+90d','+120d'],
            datasets:[{label:'Market Price',data:[100,110,105,120,145,175,210,250],
                      borderColor:'#4286f4',backgroundColor:'rgba(66,134,244,.2)',fill:true,tension:.4},
                     {label:'Gann Angle (1x1)',data:[null,null,null,120,150,180,210,240],
                      borderColor:'#ffffff',borderDash:[5,5],fill:false,tension:0,type:'line'}]},
      options:chartDefaultOptions
    });

    // TRI* radar
    new Chart(document.getElementById('triChart'),{
      type:'radar',
      data:{labels:['Price Shock (S_px)','Volume Shock (S_vol)','Gas Shock (S_gas)','Funding Shock (z_dF)','OI Shock (z_dOI)'],
            datasets:[{label:'Baseline (1œÉ)',data:[1,1,1,1,1],fill:true,backgroundColor:'rgba(255,255,255,.18)',borderColor:'rgba(255,255,255,.45)'},
                     {label:'Impact Shock (Z-Score)',data:[2.1,3.5,1.8,2.5,2.9],fill:true,backgroundColor:'rgba(66,134,244,.35)',borderColor:'#4286f4'}]},
      options:{...chartDefaultOptions,scales:{r:{angleLines:{color:'rgba(71,85,105,.7)'},
            grid:{color:'rgba(71,85,105,.7)'},pointLabels:{color:'#cbd5e1',font:{size:12}},
            ticks:{color:'#94a3b8',backdropColor:'rgba(0,0,0,.5)'}}}}
    });

    // Live wiring
    let lastGate = null;
    function pulse(el, open){
      if(!el) return;
      el.classList.remove('pulse-open','pulse-closed');
      void el.offsetWidth; // reflow to restart animation
      el.classList.add(open?'pulse-open':'pulse-closed');
    }

    async function loadRegime(){
      try{
        const res = await fetch('regime_snapshot.json',{cache:'no-cache'});
        if(!res.ok) return;
        const j = await res.json();
        // Values
        const tri = document.getElementById('triSigmaVal'); if(tri) tri.textContent = (j.tri_sigma??0).toFixed(2);
        const wt  = document.getElementById('wtapVal');    if(wt)  wt.textContent  = Math.round(100*(j.wtap??0));
        const kg  = document.getElementById('kgfVal');     if(kg)  kg.textContent  = (j.kinetic_gain_factor??0).toFixed(2);
        const act = document.getElementById('actionVal');  if(act) act.textContent = j.action || '‚Äî';
        const meta= document.getElementById('triMeta');    if(meta&&j.timestamp) meta.textContent='Updated '+new Date(j.timestamp).toLocaleString();

        // Color policy for action
        if(act){
          act.classList.remove('text-green-400','text-blue-300','text-red-400');
          const open = !!j.regime_open;
          if(open) act.classList.add('text-green-400');
          else if((j.action||'').toUpperCase().includes('DEFENSIVE')||(j.action||'').toUpperCase().includes('FADE'))
            act.classList.add('text-blue-300');
          else act.classList.add('text-red-400');
        }

        // Gate badges + pulse on flip
        const openBadge = document.getElementById('openBadge');
        const closedBadge = document.getElementById('closedBadge');
        const gateCard = document.getElementById('gateCard');
        const open = !!j.regime_open;
        if(openBadge && closedBadge){
          openBadge.style.opacity = open? '1':'0.25';
          closedBadge.style.opacity = open? '0.25':'1';
        }
        if(lastGate!==null && open!==lastGate) pulse(gateCard, open);
        lastGate = open;

      }catch(e){/*silent*/}
    }
    loadRegime(); setInterval(loadRegime, 5000);
  </script>
</body>
</html>
