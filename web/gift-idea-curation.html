<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gift Idea Curation</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple modal styles */
        #explanation-modal {
            transition: opacity 0.3s ease;
        }
        #explanation-modal-content {
            transition: transform 0.3s ease;
        }
        /* Simple loading spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Explanation Modal -->
    <div id="explanation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
        <div id="explanation-modal-content" class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md transform scale-95">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-900">✨ What's this gift?</h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            <div id="modal-body" class="text-gray-700">
                <div class="flex justify-center items-center h-24">
                    <div class="loader"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <!-- Header -->
        <header class="text-center mb-10 md:mb-16">
            <h1 class="text-3xl md:text-5xl font-bold text-gray-900 mb-2">
                Extra-special gifting made extra-easy
            </h1>
            <p class="text-lg md:text-xl text-gray-600">
                Discover perfect picks for the occasion!
            </p>
        </header>

        <!-- NEW: AI-Powered Gift Finder -->
        <section class="mb-10 md:mb-16 bg-white p-6 md:p-8 rounded-lg shadow-lg border border-gray-100">
            <h2 class="text-2xl font-semibold mb-4 text-gray-900 text-center">✨ AI-Powered Gift Finder</h2>
            <p class="text-center text-gray-600 mb-6">Describe the person you're shopping for, and our AI will suggest unique digital & printable gift ideas.</p>
            <div class="flex flex-col md:flex-row gap-4 mb-4">
                <div class="flex-grow">
                    <label for="recipient-desc" class="block text-sm font-medium text-gray-700 mb-1">Who is this for?</label>
                    <textarea id="recipient-desc" rows="3" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="e.g., My sister who loves astrology, cozy games, and her cat."></textarea>
                </div>
                <div class="w-full md:w-1/3">
                    <label for="recipient-occasion" class="block text-sm font-medium text-gray-700 mb-1">Occasion</label>
                    <select id="recipient-occasion" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 bg-white h-[84px]">
                        <option>Birthday</option>
                        <option>Christmas</option>
                        <option>Anniversary</option>
                        <option>Thank You</option>
                        <option>Just Because</option>
                        <option>Housewarming</option>
                        <option>Wedding</option>
                        <option>New Baby</option>
                        <option>Get Well</option>
                        <option>Sympathy</option>
                        <option>Engagement</option>
                        <option>Halloween</option>
                        <option>Hanukkah</option>
                    </select>
                </div>
            </div>
            <button id="get-ai-suggestions" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-md font-semibold text-lg hover:bg-indigo-700 transition-colors duration-200 flex items-center justify-center gap-2">
                Get AI-Powered Suggestions
            </button>
            <div id="ai-loading" class="hidden flex-col items-center justify-center pt-8">
                <div class="loader"></div>
                <p class="text-gray-600 mt-2">Thinking of the perfect gift...</p>
            </div>
            <div id="ai-results" class="mt-6 pt-6 border-t border-gray-200">
                <!-- AI results will be injected here -->
            </div>
        </section>


        <!-- Occasions Section -->
        <section class="mb-10 md:mb-16">
            <h2 class="text-2xl font-semibold mb-4 text-gray-900">Gift Suggestions by Occasion</h2>
            <div class="flex flex-wrap gap-2 md:gap-3">
                <a href="#" class="bg-red-100 text-red-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-red-200 hover:text-red-900 transition-colors duration-200">Christmas</a>
                <a href="#" class="bg-orange-100 text-orange-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-orange-200 hover:text-orange-900 transition-colors duration-200">Halloween</a>
                <a href="#" class="bg-blue-100 text-blue-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-blue-200 hover:text-blue-900 transition-colors duration-200">Hanukkah</a>
                <a href="#" class="bg-pink-100 text-pink-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-pink-200 hover:text-pink-900 transition-colors duration-200">Wedding</a>
                <a href="#" class="bg-purple-100 text-purple-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-purple-200 hover:text-purple-900 transition-colors duration-200">Birthday</a>
                <a href="#" class="bg-indigo-100 text-indigo-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-indigo-200 hover:text-indigo-900 transition-colors duration-200">Anniversary</a>
                <a href="#" class="bg-teal-100 text-teal-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-teal-200 hover:text-teal-900 transition-colors duration-200">Thank You</a>
                <a href="#" class="bg-gray-200 text-gray-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Sympathy</a>
                <a href="#" class="bg-green-100 text-green-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-green-200 hover:text-green-900 transition-colors duration-200">Get Well</a>
                <a href="#" class="bg-rose-100 text-rose-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-rose-200 hover:text-rose-900 transition-colors duration-200">Engagement</a>
                <a href="#" class="bg-cyan-100 text-cyan-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-cyan-200 hover:text-cyan-900 transition-colors duration-200">New Baby</a>
                <a href="#" class="bg-lime-100 text-lime-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-lime-200 hover:text-lime-900 transition-colors duration-200">Expecting Parent</a>
                <a href="#" class="bg-yellow-100 text-yellow-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-yellow-200 hover:text-yellow-900 transition-colors duration-200">Just Because</a>
                <a href="#" class="bg-fuchsia-100 text-fuchsia-800 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-fuchsia-200 hover:text-fuchsia-900 transition-colors duration-200">Housewarming</a>
            </div>
        </section>

        <!-- Christmas Specific Ideas Section -->
        <section class="mb-10 md:mb-16">
            <h2 class="text-2xl font-semibold mb-4 text-gray-900">More Ideas for Christmas</h2>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                <a href="#" class="bg-white p-4 rounded-lg shadow-sm text-center font-medium text-gray-700 hover:shadow-md transition-shadow duration-200 flex items-center justify-center h-24">Stocking Stuffers</a>
                <a href="#" class="bg-white p-4 rounded-lg shadow-sm text-center font-medium text-gray-700 hover:shadow-md transition-shadow duration-200 flex items-center justify-center h-24">Festive Candle Displays</a>
                <a href="#" class="bg-white p-4 rounded-lg shadow-sm text-center font-medium text-gray-700 hover:shadow-md transition-shadow duration-200 flex items-center justify-center h-24">Christmas Host Gifts</a>
                <a href="#" class="bg-white p-4 rounded-lg shadow-sm text-center font-medium text-gray-700 hover:shadow-md transition-shadow duration-200 flex items-center justify-center h-24">Christmas Gift Boxes</a>
                <a href="#" class="bg-white p-4 rounded-lg shadow-sm text-center font-medium text-gray-700 hover:shadow-md transition-shadow duration-200 flex items-center justify-center h-24">Ugly Christmas Sweaters</a>
                <a href="#" class="bg-white p-4 rounded-lg shadow-sm text-center font-medium text-gray-700 hover:shadow-md transition-shadow duration-200 flex items-center justify-center h-24">Hot Chocolate Bombs</a>
                <a href="#" class="bg-white p-4 rounded-lg shadow-sm text-center font-medium text-gray-700 hover:shadow-md transition-shadow duration-200 flex items-center justify-center h-24">Custom Pet Ornaments</a>
                <a href="#" class="bg-white p-4 rounded-lg shadow-sm text-center font-medium text-gray-700 hover:shadow-md transition-shadow duration-200 flex items-center justify-center h-24">Handknit Christmas Sweaters</a>
            </div>
        </section>

        <!-- Interests Section -->
        <section class="mb-10 md:mb-16">
            <h2 class="text-2xl font-semibold mb-4 text-gray-900">Browse by Interest</h2>
            <div class="flex flex-wrap gap-2 md:gap-3">
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Humor</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Science</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Sentimental Gifts</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Nature</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Useful Gifts</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Tech</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Jewelry</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Travel</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Crafting</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Fashion</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Video Games</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Hosting</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Astrology</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Pop Culture</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Romance</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Beer, Wine & Cocktails</a>
                <a href="#" class="bg-gray-200 text-gray-700 px-3 py-1.5 rounded-full text-sm font-medium hover:bg-gray-300 hover:text-gray-900 transition-colors duration-200">Music</a>
            </div>
        </section>

        <!-- NEW Digital & Print-on-Demand Section -->
        <section>
            <h2 class="text-2xl font-semibold mb-5 text-gray-900">Digital & Print-on-Demand Gift Ideas</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

                <!-- Digital Product Card 1: Funny Art Print -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden transition-shadow duration-300 hover:shadow-xl flex flex-col">
                    <img src="https://placehold.co/400x300/E0F2FE/0891B2?text=Funny+Cartoon+Print" 
                         alt="Funny cartoon to frame" 
                         class="w-full h-48 object-cover"
                         onerror="this.src='https://placehold.co/400x300/EFEFEF/B0B0B0?text=Image+Error'; this.onerror=null;">
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="font-semibold text-base text-gray-900 mb-1 flex-grow gift-title">"Caffeinated existentialism" - Funny Cartoon Print</h3>
                        <p class="text-sm text-gray-500 mb-2 gift-desc">High-resolution digital download. Print and frame instantly.</p>
                        <div class="flex items-baseline gap-2 mb-4">
                            <span class="text-xl font-bold text-gray-900">$8.50</span>
                            <span class="text-sm font-medium text-cyan-700">Digital Download</span>
                        </div>
                        <button class="w-full mt-auto bg-gray-100 text-gray-700 py-2 rounded-md text-sm font-medium hover:bg-gray-200 transition-colors mb-2">
                            View Details
                        </button>
                        <button class="w-full mt-auto bg-cyan-50 text-cyan-700 py-2 rounded-md text-sm font-medium hover:bg-cyan-100 transition-colors explain-gift-btn">
                            ✨ Explain This Gift
                        </button>
                    </div>
                </div>

                <!-- Digital Product Card 5: Auto Tarot Service -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden transition-shadow duration-300 hover:shadow-xl flex flex-col">
                    <img src="https://placehold.co/400x300/F0F9FF/0E7490?text=Automated+Insights" 
                         alt="Automated Daily Tarot Service" 
                         class="w-full h-48 object-cover"
                         onerror="this.src='https://placehold.co/400x300/EFEFEF/B0B0B0?text=Image+Error'; this.onerror=null;">
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="font-semibold text-base text-gray-900 mb-1 flex-grow gift-title">Automated Insight: Daily Tarot Service</h3>
                        <p class="text-sm text-gray-500 mb-2 gift-desc">Customizable subscription. A daily/weekly card & reflection prompt sent automatically. Choose theme & schedule.</p>
                        <div class="flex items-baseline gap-2 mb-4">
                            <span class="text-xl font-bold text-gray-900">$19.99</span>
                            <span class="text-sm font-medium text-cyan-700">Digital Subscription</span>
                        </div>
                        <button class="w-full mt-auto bg-gray-100 text-gray-700 py-2 rounded-md text-sm font-medium hover:bg-gray-200 transition-colors mb-2">
                            Customize Gift
                        </button>
                        <button class="w-full mt-auto bg-cyan-50 text-cyan-700 py-2 rounded-md text-sm font-medium hover:bg-cyan-100 transition-colors explain-gift-btn">
                            ✨ Explain This Gift
                        </button>
                    </div>
                </div>

            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center mt-16 py-8 border-t border-gray-200">
            <p class="text-sm text-gray-500">&copy; 2025 Gift Finder. All rights reserved.</p>
        </footer>

    </div>

    <script type="module">
        // --- Gemini API Call Function ---
        // IMPORTANT: In a real app, you would have exponential backoff and more robust error handling.
        async function callGeminiApi(systemPrompt, userQuery) {
            const apiKey = window.GEMINI_API_KEY || '';
            if (!apiKey) {
                console.warn('Gemini API key not detected. Set window.GEMINI_API_KEY to enable live responses.');
                return "Sorry, I couldn't reach the gift assistant right now. Please check your API configuration and try again.";
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    return candidate.content.parts[0].text;
                } else {
                    throw new Error("Invalid response structure from API.");
                }

            } catch (error) {
                console.error("Gemini API call error:", error);
                return "Sorry, I couldn't get a response right now. Please try again later.";
            }
        }

        // --- AI-Powered Gift Finder Logic ---
        const getAISuggestionsBtn = document.getElementById('get-ai-suggestions');
        const recipientDescInput = document.getElementById('recipient-desc');
        const recipientOccasionInput = document.getElementById('recipient-occasion');
        const aiLoading = document.getElementById('ai-loading');
        const aiResults = document.getElementById('ai-results');

        getAISuggestionsBtn.addEventListener('click', async () => {
            const description = recipientDescInput.value;
            const occasion = recipientOccasionInput.value;

            if (!description.trim()) {
                aiResults.innerHTML = `<p class="text-red-600">Please describe the recipient first!</p>`;
                return;
            }

            aiLoading.classList.remove('hidden');
            aiResults.innerHTML = ''; // Clear old results

            const systemPrompt = "You are an expert gift-giving assistant specializing in creative, unique digital, and print-on-demand gifts. Your suggestions should be personal, thoughtful, and align with the types of gifts sold on this site (like printable art, digital subscriptions, 3D print files, unique digital services). Do not suggest physical products like clothes or electronics. Respond with a list of 3-5 specific gift ideas. For each idea, provide a creative title in bold (e.g., **Custom Star Map Print**) followed by a one-sentence description.";
            const userQuery = `Occasion: ${occasion}\nRecipient: ${description}`;

            const responseText = await callGeminiApi(systemPrompt, userQuery);

            aiLoading.classList.add('hidden');
            
            // Format the response text as HTML
            const formattedHtml = responseText
                .split('\n') // Split by newlines
                .map(line => line.trim())
                .filter(line => line.length > 0)
                .map(line => {
                    // Make text wrapped in ** bold
                    line = line.replace(/\*\*(.*?)\*\*/g, '<strong class="text-gray-900">$1</strong>');
                    return `<div class="p-4 bg-indigo-50 rounded-lg mb-3 shadow-sm">
                                <p class="text-gray-700">${line}</p>
                            </div>`;
                })
                .join('');
            
            aiResults.innerHTML = `<h3 class="text-xl font-semibold mb-4 text-gray-900">Here are a few ideas:</h3>${formattedHtml}`;
        });

        // --- "Explain This Gift" Modal Logic ---
        const modal = document.getElementById('explanation-modal');
        const modalContent = document.getElementById('explanation-modal-content');
        const closeModalBtn = document.getElementById('close-modal');
        const modalBody = document.getElementById('modal-body');
        const explainGiftBtns = document.querySelectorAll('.explain-gift-btn');

        const showModal = () => {
            modal.classList.remove('opacity-0', 'pointer-events-none');
            modalContent.classList.remove('scale-95');
        };

        const hideModal = () => {
            modal.classList.add('opacity-0', 'pointer-events-none');
            modalContent.classList.add('scale-95');
        };

        closeModalBtn.addEventListener('click', hideModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                hideModal();
            }
        });

        explainGiftBtns.forEach(btn => {
            btn.addEventListener('click', async (e) => {
                // Find the parent card
                const card = e.target.closest('.flex-col');
                const title = card.querySelector('.gift-title').textContent.trim();
                const desc = card.querySelector('.gift-desc').textContent.trim();

                // Show modal with loading state
                modalBody.innerHTML = `<div class="flex justify-center items-center h-24"><div class="loader"></div></div>`;
                showModal();

                const systemPrompt = "You are a creative marketing assistant. Briefly explain what this digital/printable gift is and why it makes a special, thoughtful present. Your tone should be warm and enthusiastic. Keep it to a single, concise paragraph.";
                const userQuery = `Gift Title: ${title}\nDescription: ${desc}`;

                const responseText = await callGeminiApi(systemPrompt, userQuery);

                // Update modal with response
                modalBody.innerHTML = `<p class="text-gray-700">${responseText.replace(/\n/g, '<br>')}</p>`;
            });
        });

    </script>
</body>
</html>
