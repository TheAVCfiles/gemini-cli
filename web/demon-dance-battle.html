<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Demon Dance Battle</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              inter: ['Inter', 'sans-serif'],
            },
            animation: {
              'spin-slow': 'spin 6s linear infinite',
            },
            dropShadow: {
              glowcyan: '0 0 10px rgba(52,211,235,0.9)',
              glowfuchsia: '0 0 40px rgba(217,70,239,0.5)',
            },
            backgroundImage: {
              'stage-gradient': 'radial-gradient(at 50% 100%, #150030 0%, #000000 70%)',
            },
          },
        },
      };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
    </style>
  </head>
  <body class="min-h-screen bg-black text-white">
    <div id="root" class="min-h-screen"></div>
    <script type="module">
      import React, {
        useCallback,
        useEffect,
        useMemo,
        useState,
      } from 'https://esm.sh/react@18.3.1';
      import { createRoot } from 'https://esm.sh/react-dom@18.3.1/client';
      import {
        Award,
        Check,
        Pause,
        Play,
        ShoppingBag,
        Sparkles,
        Star,
        Zap,
      } from 'https://esm.sh/lucide-react@0.453.0';

      const ACTIONS = {
        SPIN: {
          name: 'Spin',
          emoji: 'ðŸ”„',
          color: 'bg-fuchsia-600',
          icon: 'ðŸŒ€',
          glow: 'rgba(217,70,239,0.85)',
        },
        STRIKE: {
          name: 'Strike',
          emoji: 'ðŸ‘Š',
          color: 'bg-red-600',
          icon: 'âš”ï¸',
          glow: 'rgba(239,68,68,0.85)',
        },
        JUMP: {
          name: 'Jump',
          emoji: 'â¬†ï¸',
          color: 'bg-cyan-600',
          icon: 'âš¡',
          glow: 'rgba(8,145,178,0.85)',
        },
        POSE: {
          name: 'Pose',
          emoji: 'ðŸ’…',
          color: 'bg-indigo-600',
          icon: 'â­',
          glow: 'rgba(79,70,229,0.85)',
        },
      };

      const DANCE_MOVES = [
        {
          name: 'Demon Portal Spin',
          action: ACTIONS.SPIN,
          description: 'A fluid, gravity-defying swirl.',
          power: 'SPEED',
        },
        {
          name: 'Spirit Sword Strike',
          action: ACTIONS.STRIKE,
          description: 'A sharp slice to banish shadows.',
          power: 'POWER',
        },
        {
          name: 'Shadow Step Slide',
          action: ACTIONS.POSE,
          description: 'A stylish, quick transition.',
          power: 'STEALTH',
        },
        {
          name: 'Energy Wave Jump',
          action: ACTIONS.JUMP,
          description: 'Leap high to launch energy.',
          power: 'ENERGY',
        },
        {
          name: 'Heart Shield Pop',
          action: ACTIONS.POSE,
          description: 'Pop and lock with attitude.',
          power: 'SHIELD',
        },
        {
          name: 'Thunder Kick Combo',
          action: ACTIONS.STRIKE,
          description: 'Powerful triple-kick sequence.',
          power: 'STRIKE',
        },
        {
          name: 'Mystic Hip Roll',
          action: ACTIONS.SPIN,
          description: 'Roll those hips in a magic circle.',
          power: 'MAGIC',
        },
        {
          name: 'Victory Star Pose',
          action: ACTIONS.JUMP,
          description: 'End with a dazzling, high stance.',
          power: 'CHARM',
        },
      ];

      const SHOP_ITEMS = [
        {
          id: 1,
          name: 'Neon Cybersuit',
          emoji: 'ðŸ‘š',
          cost: 150,
          type: 'outfit',
          color: 'text-cyan-400',
        },
        {
          id: 2,
          name: 'Celestial Wings',
          emoji: 'ðŸ•Šï¸',
          cost: 220,
          type: 'accessory',
          color: 'text-purple-300',
        },
        {
          id: 3,
          name: 'Rave Cat Headphones',
          emoji: 'ðŸŽ§',
          cost: 120,
          type: 'accessory',
          color: 'text-lime-400',
        },
        {
          id: 4,
          name: 'Vampire Sneakers',
          emoji: 'ðŸ‘Ÿ',
          cost: 180,
          type: 'shoes',
          color: 'text-red-400',
        },
        {
          id: 5,
          name: 'Glitter Bomb Lipstick',
          emoji: 'ðŸ’„',
          cost: 90,
          type: 'accessory',
          color: 'text-pink-400',
        },
        {
          id: 6,
          name: 'Holographic Skirt',
          emoji: 'ðŸ‘—',
          cost: 160,
          type: 'outfit',
          color: 'text-yellow-400',
        },
        {
          id: 7,
          name: 'K-Pop Ring Light',
          emoji: 'ðŸ’¡',
          cost: 80,
          type: 'accessory',
          color: 'text-white',
        },
        {
          id: 8,
          name: 'Aura Booster Drink',
          emoji: 'ðŸ¹',
          cost: 50,
          type: 'food',
          color: 'text-orange-400',
        },
      ];

      const MOVE_TIME_MS = 2500;

      const feedbackStyle = (feedback) => {
        switch (feedback) {
          case 'PERFECT!':
            return 'text-4xl sm:text-5xl text-cyan-300 tracking-widest drop-shadow-[0_0_15px_rgba(52,211,235,1)]';
          case 'GREAT!':
            return 'text-3xl sm:text-4xl text-green-400 drop-shadow-[0_0_10px_rgba(74,222,128,1)]';
          case 'GOOD!':
            return 'text-2xl sm:text-3xl text-indigo-300 drop-shadow-[0_0_8px_rgba(129,140,248,1)]';
          case 'WRONG!':
          case 'MISS!':
            return 'text-4xl sm:text-5xl text-red-500 tracking-widest drop-shadow-[0_0_20px_rgba(239,68,68,1)]';
          default:
            return 'text-2xl text-white';
        }
      };

      const formatGlow = (color) => ({
        boxShadow: `0 0 15px ${color}`,
      });

      const App = () => {
        const [isPlaying, setIsPlaying] = useState(false);
        const [currentMoveIndex, setCurrentMoveIndex] = useState(0);
        const [score, setScore] = useState(0);
        const [coins, setCoins] = useState(0);
        const [combo, setCombo] = useState(0);
        const [level, setLevel] = useState(1);
        const [showShop, setShowShop] = useState(false);
        const [inventory, setInventory] = useState([]);
        const [equippedItem, setEquippedItem] = useState(null);
        const [moveStartTime, setMoveStartTime] = useState(0);
        const [feedback, setFeedback] = useState('');
        const [now, setNow] = useState(Date.now());

        const startNextMove = useCallback(() => {
          const newMoveIndex = Math.floor(Math.random() * DANCE_MOVES.length);
          setCurrentMoveIndex(newMoveIndex);
          setMoveStartTime(Date.now());
        }, []);

        const handleMoveResult = useCallback(
          (success, scoreIncrease = 0, coinsGain = 0) => {
            setMoveStartTime(0);

            if (success) {
              setCombo((prevCombo) => {
                const newCombo = prevCombo + 1;
                setScore((prevScore) => prevScore + scoreIncrease + newCombo * 5);
                setCoins(
                  (prevCoins) =>
                    prevCoins + coinsGain + Math.floor(newCombo / 5) * 2 + 2,
                );
                return newCombo;
              });
            } else {
              setCombo(0);
            }

            setTimeout(() => {
              setFeedback('');
              if (isPlaying) {
                startNextMove();
              }
            }, 500);
          },
          [isPlaying, startNextMove],
        );

        useEffect(() => {
          if (!isPlaying) {
            return;
          }

          if (moveStartTime === 0) {
            return;
          }

          const timeout = setTimeout(() => {
            setFeedback('MISS!');
            handleMoveResult(false);
          }, MOVE_TIME_MS);

          return () => clearTimeout(timeout);
        }, [handleMoveResult, isPlaying, moveStartTime]);

        useEffect(() => {
          if (score >= level * 500) {
            setLevel((prev) => prev + 1);
          }
        }, [score, level]);

        useEffect(() => {
          if (!isPlaying || moveStartTime === 0) {
            return;
          }

          const interval = setInterval(() => {
            setNow(Date.now());
          }, 100);

          return () => clearInterval(interval);
        }, [isPlaying, moveStartTime]);

        const handleStartStopClick = () => {
          const newState = !isPlaying;
          setIsPlaying(newState);
          if (newState) {
            setFeedback('');
            startNextMove();
          } else {
            setMoveStartTime(0);
            setFeedback('Paused...');
          }
        };

        const handleUserAction = (actionPressed) => {
          if (!isPlaying || moveStartTime === 0 || feedback) {
            return;
          }

          const timeElapsed = Date.now() - moveStartTime;
          const requiredAction = DANCE_MOVES[currentMoveIndex].action;
          const isCorrect = actionPressed.name === requiredAction.name;

          if (isCorrect) {
            const perfectWindow = 500;
            const greatWindow = 1000;
            let feedbackText = 'GOOD!';
            let scoreIncrease = 10;

            if (timeElapsed >= MOVE_TIME_MS - perfectWindow) {
              feedbackText = 'PERFECT!';
              scoreIncrease = 50;
            } else if (timeElapsed >= MOVE_TIME_MS - greatWindow) {
              feedbackText = 'GREAT!';
              scoreIncrease = 30;
            }

            setFeedback(feedbackText);
            handleMoveResult(true, scoreIncrease, 1);
          } else {
            setFeedback('WRONG!');
            handleMoveResult(false);
          }
        };

        const buyItem = (item) => {
          setCoins((prevCoins) => {
            if (prevCoins < item.cost || inventory.some((i) => i.id === item.id)) {
              return prevCoins;
            }

            setInventory((prevInventory) => [...prevInventory, item]);
            setEquippedItem(item);
            return prevCoins - item.cost;
          });
        };

        const equipItem = (item) => {
          setEquippedItem(item);
        };

        const currentMove = useMemo(
          () => DANCE_MOVES[currentMoveIndex],
          [currentMoveIndex],
        );

        const timeRemaining = useMemo(() => {
          if (!moveStartTime) {
            return MOVE_TIME_MS;
          }
          const remaining = MOVE_TIME_MS - (now - moveStartTime);
          return Math.max(0, remaining);
        }, [moveStartTime, now]);

        const progressPercent = Math.max(
          0,
          Math.min(100, (timeRemaining / MOVE_TIME_MS) * 100),
        );

        const ActionButton = ({ action }) => (
          <button
            onClick={() => handleUserAction(action)}
            disabled={!isPlaying || moveStartTime === 0 || Boolean(feedback)}
            className={`flex flex-col items-center justify-center p-3 sm:p-4 rounded-lg font-black text-sm sm:text-lg text-white transition-all duration-100 transform active:scale-95 border-2 border-transparent ${action.color} ${
              isPlaying && moveStartTime > 0
                ? 'shadow-xl shadow-black/80 hover:scale-[1.05] border-fuchsia-400/50'
                : 'opacity-50 cursor-not-allowed'
            }`}
            style={
              isPlaying && moveStartTime > 0
                ? formatGlow(action.glow)
                : undefined
            }
          >
            <div className="text-3xl sm:text-4xl mb-1 drop-shadow-md">
              {action.emoji}
            </div>
            {action.name.toUpperCase()}
          </button>
        );

        const ShopItemCard = ({ item }) => {
          const isInInventory = inventory.some((i) => i.id === item.id);
          const isEquipped = equippedItem?.id === item.id;

          return (
            <div
              className={`bg-black/40 rounded-xl p-4 text-center backdrop-blur flex flex-col items-center justify-between h-full transition hover:bg-black/60 border-2 border-transparent ${
                isEquipped
                  ? 'border-cyan-400 shadow-[0_0_15px_rgba(52,211,235,0.7)]'
                  : 'border-gray-700'
              }`}
            >
              <div>
                <div className={`text-4xl sm:text-5xl mb-2 ${item.color} drop-shadow-lg`}>
                  {item.emoji}
                </div>
                <h3 className="font-extrabold mb-2 text-sm sm:text-base text-gray-100">
                  {item.name}
                </h3>
              </div>

              <div className="w-full mt-3">
                {isInInventory ? (
                  <button
                    onClick={() => equipItem(item)}
                    className={`w-full py-2 rounded-lg font-bold text-sm transition-all duration-150 shadow-md ${
                      isEquipped
                        ? 'bg-cyan-500 text-black shadow-lg shadow-cyan-500/50'
                        : 'bg-fuchsia-500 hover:bg-fuchsia-600 text-white'
                    }`}
                  >
                    {isEquipped ? (
                      <>
                        <Check size={16} className="inline mr-1" /> EQUIPPED
                      </>
                    ) : (
                      'Equip Status'
                    )}
                  </button>
                ) : (
                  <button
                    onClick={() => buyItem(item)}
                    disabled={coins < item.cost}
                    className={`w-full py-2 rounded-lg font-bold text-sm transition-all duration-150 shadow-md ${
                      coins >= item.cost
                        ? 'bg-red-600 hover:bg-red-700 active:scale-95 shadow-red-900/50'
                        : 'bg-gray-700 cursor-not-allowed opacity-70 text-gray-400'
                    }`}
                  >
                    {coins >= item.cost
                      ? `Buy ðŸ’° ${item.cost}`
                      : `ðŸ’° ${item.cost} (LOCKED)`}
                  </button>
                )}
              </div>
            </div>
          );
        };

        return (
          <div
            className="min-h-screen bg-stage-gradient text-white p-4 sm:p-6 font-inter"
          >
            <div className="max-w-4xl mx-auto mb-6">
              <div className="bg-black/70 rounded-xl p-3 backdrop-blur border-2 border-gray-700 shadow-2xl shadow-fuchsia-900/30">
                <div className="flex justify-around items-center flex-wrap text-sm sm:text-base gap-2 tracking-wide">
                  <div className="flex items-center gap-1 sm:gap-2">
                    <Zap className="text-cyan-400 w-5 h-5 drop-shadow-[0_0_5px_cyan]" />
                    <span className="font-bold text-cyan-200">LEVEL {level}</span>
                  </div>
                  <div className="flex items-center gap-1 sm:gap-2">
                    <Star className="text-yellow-400 w-5 h-5 drop-shadow-[0_0_5px_yellow]" />
                    <span className="font-bold text-yellow-300">SCORE: {score}</span>
                  </div>
                  <div className="flex items-center gap-1 sm:gap-2">
                    <Award className="text-red-400 w-5 h-5 drop-shadow-[0_0_5px_red]" />
                    <span
                      className={`font-black tracking-widest ${
                        combo > 0
                          ? 'text-red-500 drop-shadow-[0_0_8px_red]'
                          : 'text-gray-400'
                      }`}
                    >
                      COMBO: {combo}x
                    </span>
                  </div>
                  <div className="flex items-center gap-1 sm:gap-2">
                    <div className="text-xl sm:text-2xl text-yellow-500">ðŸ’°</div>
                    <span className="font-bold text-yellow-300">{coins} CREDITS</span>
                  </div>
                </div>
              </div>
            </div>

            {!showShop ? (
              <div className="max-w-4xl mx-auto">
                <div className="bg-gradient-to-b from-gray-900 to-black rounded-3xl p-6 sm:p-8 shadow-[0_0_40px_rgba(255,0,100,0.5)] border-4 border-fuchsia-500">
                  <h1 className="text-2xl sm:text-4xl font-black text-center mb-6 text-fuchsia-300 tracking-widest drop-shadow-[0_0_10px_rgba(255,0,100,0.8)]">
                    // CORE STAGE //
                  </h1>

                  <div className="text-center mb-4 min-h-[40px]">
                    {equippedItem && (
                      <div className="inline-flex items-center bg-black/60 p-2 rounded-full border border-cyan-400 shadow-lg shadow-cyan-900/50">
                        <Sparkles className="w-4 h-4 text-cyan-300 mr-1 animate-spin-slow" />
                        <span className="text-xs font-semibold text-gray-300 mr-2">
                          STATUS EFFECT:
                        </span>
                        <span
                          className={`text-xl font-bold tracking-wider ${equippedItem.color}`}
                          title={equippedItem.name}
                        >
                          {equippedItem.emoji} {equippedItem.name}
                        </span>
                      </div>
                    )}
                  </div>

                  <div className="bg-black/70 rounded-2xl p-6 sm:p-8 mb-6 min-h-[250px] flex flex-col justify-center items-center relative overflow-hidden border-2 border-gray-700 shadow-inner shadow-fuchsia-900/50">
                    {isPlaying && moveStartTime > 0 && (
                      <div
                        className="absolute top-0 left-0 h-2 bg-gradient-to-r from-red-600 to-yellow-400"
                        style={{ width: `${progressPercent}%`, transition: 'width 0.1s linear' }}
                      ></div>
                    )}

                    {feedback && (
                      <div
                        className={`absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm z-10 font-black transition-opacity duration-300 ${feedbackStyle(
                          feedback,
                        )}`}
                      >
                        {feedback}
                      </div>
                    )}

                    <div className="text-6xl sm:text-8xl mb-4 text-cyan-400 drop-shadow-[0_0_10px_cyan] animate-pulse">
                      {currentMove.action.icon}
                    </div>
                    <h2 className="text-2xl sm:text-3xl font-black mb-2 text-center text-red-400 tracking-widest drop-shadow-[0_0_5px_red]">
                      {currentMove.name}
                    </h2>
                    <p className="text-base sm:text-lg text-center mb-4 text-gray-300 italic">
                      {currentMove.description}
                    </p>
                    <div className="bg-fuchsia-800 px-4 py-2 rounded-full shadow-lg shadow-fuchsia-900/50 border border-fuchsia-400">
                      <span className="font-bold text-sm sm:text-lg text-white">
                        ACTION: {currentMove.action.name.toUpperCase()}
                      </span>
                    </div>
                  </div>

                  <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 mb-6">
                    {Object.values(ACTIONS).map((action) => (
                      <ActionButton key={action.name} action={action} />
                    ))}
                  </div>

                  <div className="flex justify-center gap-4 mb-6">
                    <button
                      onClick={handleStartStopClick}
                      className="bg-gradient-to-r from-green-500 to-lime-600 hover:from-green-600 hover:to-lime-700 px-6 sm:px-8 py-3 sm:py-4 rounded-full font-black text-lg sm:text-xl flex items-center gap-3 shadow-lime-900/50 shadow-lg transform hover:scale-[1.02] active:scale-95 transition-all duration-150 border-2 border-lime-300"
                      style={{ textShadow: '0 0 5px #a7f3d0' }}
                    >
                      {isPlaying ? <Pause size={28} /> : <Play size={28} />}
                      {isPlaying ? 'PAUSE BATTLE' : 'START RHYTHM!'}
                    </button>
                  </div>

                  <div className="text-center">
                    <p className="text-base sm:text-lg text-gray-400">
                      {isPlaying ? (
                        combo > 15 ? (
                          <span className="text-yellow-400 drop-shadow-[0_0_8px_yellow] font-bold">
                            UNSTOPPABLE! PUSH THE LIMITS!
                          </span>
                        ) : combo > 5 ? (
                          <span className="text-red-400 font-bold">
                            RISING HEAT! MAINTAIN THE CHAIN!
                          </span>
                        ) : (
                          'FIGHT! Match the move action before the bar runs out.'
                        )
                      ) : (
                        'PRESS START to enter the Demon Dance Zone.'
                      )}
                    </p>
                  </div>
                </div>

                <div className="text-center mt-6">
                  <button
                    onClick={() => setShowShop(true)}
                    className="bg-black/80 hover:bg-black/90 px-6 sm:px-8 py-3 sm:py-4 rounded-full font-black text-lg sm:text-xl flex items-center gap-3 shadow-fuchsia-500/50 shadow-[0_0_20px_rgba(217,70,239,0.7)] transform hover:scale-[1.02] active:scale-95 transition mx-auto border-2 border-fuchsia-500 text-fuchsia-300"
                  >
                    <ShoppingBag size={24} className="drop-shadow-[0_0_5px_rgba(217,70,239,1)]" />
                    VISIT THE GLAM SHOP
                  </button>
                </div>
              </div>
            ) : (
              <div className="max-w-4xl mx-auto">
                <div className="bg-gradient-to-b from-gray-900 to-black rounded-3xl p-6 sm:p-8 shadow-[0_0_40px_rgba(52,211,235,0.5)] border-4 border-cyan-500">
                  <h1 className="text-3xl sm:text-4xl font-black text-center mb-6 text-cyan-300 tracking-widest drop-shadow-[0_0_10px_rgba(52,211,235,0.8)]">
                    // GLAM SHOP & INVENTORY //
                  </h1>

                  <p className="text-center text-gray-400 mb-6">
                    Acquire covetable, high-status gear to enhance your aesthetic and show your dedication.
                  </p>

                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    {SHOP_ITEMS.map((item) => (
                      <ShopItemCard key={item.id} item={item} />
                    ))}
                  </div>

                  <div className="text-center mt-6">
                    <button
                      onClick={() => setShowShop(false)}
                      className="bg-black/80 hover:bg-black/90 px-6 sm:px-8 py-3 sm:py-4 rounded-full font-black text-lg sm:text-xl shadow-cyan-500/50 shadow-[0_0_20px_rgba(52,211,235,0.7)] transform hover:scale-[1.02] active:scale-95 transition mx-auto border-2 border-cyan-500 text-cyan-300"
                    >
                      RETURN TO STAGE
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
